<!DOCTYPE html>
<html lang="pt" dir="ltr">

<head>
  <link rel="stylesheet" href="/css/index.css">
  <link rel="stylesheet" href="/css/master.css">
  <meta charset="utf-8">
  <link rel="shortcut icon" href="assets/favicon.ico">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <title>Marvin</title>
</head>

<body>
  <main class="fullwidth">
    <div class="login">
      <h5>Parece que esse é seu primeiro acesso.
        <br>
        <br>
        Conforme indicado na <a href="https://app.projetomarvin.com/assets/pdf/Marvin+-+fase+00.pdf" target="_blank">primeira fase</a>,
        <br>
        digite aqui seu nome de usuário do github</h5>
      <form class="loginForm">
        <input type="text" name="username" placeholder="usuário do Github" />
        <br>
        <button type="submit" class="full-green">contunuar</button>
      </form>
    </div>
  </main>
  <script type="text/javascript">
    $('.loginForm').on('submit', function(e) {
      e.preventDefault()
      const usr = $('input[name=username]').val();
      $.ajax({
        type: 'get',
        url: 'https://localhost/api/students/' + localStorage.userId + '/checkRepository' + '?username=' + usr + '&access_token=' + localStorage.access_token,
        crossDomain: true,
        success: function(responseData, textStatus, jqXHR) {
          console.log(responseData);
          if (responseData === "not found") {
            alert('Usuário ou repositório não encontrado. Verifique e tente novamente.')
          } else {
            console.log(responseData);
            alert('Conta vinculada com sucesso e você conseguiu seus primeiros 50 pontos de XP! Agora você deve vincular sua conta com o Github.')
            window.location.href = 'https://github.com/login/oauth/authorize?client_id=71f8116e373c16f3eb11&scope=repo&login=' + usr;
          }
        },
        error: function(responseData, textStatus, errorThrown) {
          console.log(responseData);
          alert('Algo deu errado, tente novamente.');
        }
      })
    })

  </script>
</body>

</html>
